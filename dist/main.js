(()=>{"use strict";const e={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J"};function t(e,t){return Math.floor(Math.random()*(t-e)+e)}function a(a,s){return{name:a,isComputer:s,board:{grid:[new Array(10),new Array(10),new Array(10),new Array(10),new Array(10),new Array(10),new Array(10),new Array(10),new Array(10),new Array(10)],ships:[],placeShip(e,t,a){if(!(t[0]!==a[0]&&t[1]!==a[1]||Math.abs(t[0]-a[0])+1!==e&&Math.abs(t[1]-a[1])+1!==e)){const s={length:e,hits:0,hit(){this.hits+=1},getLength(){return this.length},getHits(){return this.hits},isSunk(){return this.length===this.hits}};let r=[];if(t[1]===a[1]){let e=t[0],n=a[0];e>n&&([e,n]=[n,e]);for(let a=e;a<=n;a++)this.grid[a][t[1]]=s,r.push([a,t[1]])}else{let e=t[1],n=a[1];e>n&&([e,n]=[n,e]);for(let a=e;a<=n;a++)this.grid[t[0]][a]=s,r.push([t[0],a])}this.ships.push({ship:s,cells:r})}},getInfo(e){return this.grid[e[0]][e[1]]},recieveAttack(e){return void 0===this.grid[e[0]][e[1]]?(this.grid[e[0]][e[1]]="miss","Miss!"):"miss"===this.grid[e[0]][e[1]]?void 0:(this.grid[e[0]][e[1]].hit(),this.grid[e[0]][e[1]]="hit","Hit!")},allShipsSunk(){return 0===this.ships.filter((e=>!e.ship.isSunk())).length}},fire(a,s=[t(0,10),t(0,10)]){let r=Number(s[0]),n=Number(s[1]);for(;"miss"===a.board.getInfo([r,n])||"hit"==a.board.getInfo([r,n]);)r=t(0,10),n=t(0,10);return"Hit!"===a.board.recieveAttack([r,n])?{message:`Hit at ${e[r]}${n+1}!`,coordinates:[r,n]}:{message:`Miss at ${e[r]}${n+1}!`,coordinates:[r,n]}}}}const s=document.getElementById("player-y-and-grid"),r=document.getElementById("opponent-y-and-grid"),n=document.createElement("div");n.id="player-grid",n.classList.add("game-grid");const i=document.createElement("div");i.id="opponent-grid",i.classList.add("game-grid");for(let e=0;e<10;e++)for(let t=0;t<10;t++){let a=document.createElement("div");a.dataset.x=e,a.dataset.y=t,a.classList.add("player"),a.classList.add("cell"),n.appendChild(a);let s=document.createElement("div");s.dataset.x=e,s.dataset.y=t,s.classList.add("opponent"),s.classList.add("cell"),i.appendChild(s)}let d,o,l,c,u;s.appendChild(n),r.appendChild(i);let m={destroyer:null,cruiser:null,submarine:null,battleship:null,carrier:null};const p=document.querySelectorAll(".new-ship");window.addEventListener("keydown",(e=>{if("r"==e.key&&c.classList.contains("new-ship"))if(c.classList.contains("r")){if(Number(c.parentNode.dataset.x)+u>10)return;c.classList.remove("r")}else{if(Number(c.parentNode.dataset.y)+u>10)return;c.classList.add("r")}})),p.forEach((e=>{e.addEventListener("dragstart",(e=>{c=e.target,u=Number(c.dataset.length),c.classList.add("dragged")}))})),n.addEventListener("dragover",(e=>{e.preventDefault()})),n.addEventListener("drop",(e=>{if(e.preventDefault(),c.classList.remove("dragged"),c.parentNode!=e.target&&e.target!=c){if(c.classList.contains("r")){if(Number(e.target.dataset.y)+u>10)return}else if(Number(e.target.dataset.x)+u>10)return;c.classList.contains("not-placed")&&c.classList.remove("not-placed"),c.classList.contains("destroyer")?m.destroyer=[Number(e.target.dataset.y),Number(e.target.dataset.x)]:c.classList.contains("cruiser")?m.cruiser=[Number(e.target.dataset.y),Number(e.target.dataset.x)]:c.classList.contains("submarine")?m.submarine=[Number(e.target.dataset.y),Number(e.target.dataset.x)]:c.classList.contains("battleship")?m.battleship=[Number(e.target.dataset.y),Number(e.target.dataset.x)]:c.classList.contains("carrier")&&(m.carrier=[Number(e.target.dataset.y),Number(e.target.dataset.x)]),m.destroyer&&m.cruiser&&m.submarine&&m.battleship&&m.carrier&&(document.getElementById("player-submit-ships").disabled=!1),c.parentNode.removeChild(c),e.target.appendChild(c)}})),document.getElementById("name-input").addEventListener("click",(function(){d=document.getElementById("player-name-input").value,o=document.getElementById("opponent-name-input").value,l=document.getElementById("computer-checkbox").checked,l&&(o="Computer"),""==d&&(d="Player"),document.getElementById("background").remove(),document.getElementById("player-name").innerText=d+"'s Board",document.getElementById("opponent-name").innerText=o+"'s Board"})),document.getElementById("player-submit-ships").addEventListener("click",(e=>{e.preventDefault(),function(e){const t=[];t.push([document.getElementById(`${e}-destroyer`),1]),t.push([document.getElementById(`${e}-cruiser`),2]),t.push([document.getElementById(`${e}-submarine`),2]),t.push([document.getElementById(`${e}-battleship`),3]),t.push([document.getElementById(`${e}-carrier`),4]);const s=[];t.forEach((e=>{e[0].classList.contains("r")?s.push([[Number(e[0].parentNode.dataset.x),Number(e[0].parentNode.dataset.y)],[Number(e[0].parentNode.dataset.x),Number(e[0].parentNode.dataset.y)+e[1]],e[1]+1]):s.push([[Number(e[0].parentNode.dataset.x),Number(e[0].parentNode.dataset.y)],[Number(e[0].parentNode.dataset.x)+e[1],Number(e[0].parentNode.dataset.y)],e[1]+1])})),l&&(document.getElementById("player-boats").remove(),document.getElementById("player-submit-ships").remove(),function(e,t,s,r){const n=a(e,!1),d=a(t,s);i.classList.add("hidden"),r.forEach((e=>{n.board.placeShip(e[2],e[0],e[1])})),d.board.placeShip(4,[5,6],[8,6]),n.board.ships.forEach((e=>{e.cells.forEach((e=>{document.querySelector(`.player[data-x="${e[0]}"][data-y="${e[1]}"]`).classList.add("ship")}))})),d.board.ships.forEach((e=>{e.cells.forEach((e=>{document.querySelector(`.opponent[data-x="${e[0]}"][data-y="${e[1]}"]`).classList.add("ship")}))}));const o=function(a){let s=n.fire(d,[a.target.dataset.x,a.target.dataset.y]),r=document.querySelector(`.opponent[data-x="${s.coordinates[0]}"][data-y="${s.coordinates[1]}"]`);if(console.log(s.message),s.message.includes("Miss"))r.classList.add("miss"),r.innerText="O";else if(s.message.includes("Hit")&&(r.classList.add("hit"),r.innerText+="X",d.board.allShipsSunk()))return alert(`${e} Wins!`),void i.removeEventListener("click",o);if(d.isComputer){let e=d.fire(n),a=document.querySelector(`.player[data-x="${e.coordinates[0]}"][data-y="${e.coordinates[1]}"]`);if(e.message.includes("Miss"))a.classList.add("miss"),a.innerText="O";else if(e.message.includes("Hit")&&(a.classList.add("hit"),a.innerHTML+="X",n.board.allShipsSunk()))return alert(`${t} Wins!`),void i.removeEventListener("click",o)}};i.addEventListener("click",o)}(d,o,l,s))}("player")}))})();