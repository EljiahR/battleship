(()=>{"use strict";const e={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J"};function t(e,t){return Math.floor(Math.random()*(t-e)+e)}function s(s,a){return{name:s,isComputer:a,board:{grid:[new Array(10),new Array(10),new Array(10),new Array(10),new Array(10),new Array(10),new Array(10),new Array(10),new Array(10),new Array(10)],ships:[],placeShip(e,t,s){if(!(t[0]!==s[0]&&t[1]!==s[1]||Math.abs(t[0]-s[0])+1!==e&&Math.abs(t[1]-s[1])+1!==e)){const a={length:e,hits:0,hit(){this.hits+=1},getLength(){return this.length},getHits(){return this.hits},isSunk(){return this.length===this.hits}};let r=[];if(t[1]===s[1]){let e=t[0],i=s[0];e>i&&([e,i]=[i,e]);for(let s=e;s<=i;s++)this.grid[s][t[1]]=a,r.push([s,t[1]])}else{let e=t[1],i=s[1];e>i&&([e,i]=[i,e]);for(let s=e;s<=i;s++)this.grid[t[0]][s]=a,r.push([t[0],s])}this.ships.push({ship:a,cells:r})}},getInfo(e){return this.grid[e[0]][e[1]]},recieveAttack(e){return void 0===this.grid[e[0]][e[1]]?(this.grid[e[0]][e[1]]="miss","Miss!"):"miss"===this.grid[e[0]][e[1]]?void 0:(this.grid[e[0]][e[1]].hit(),this.grid[e[0]][e[1]]="hit","Hit!")},allShipsSunk(){return 0===this.ships.filter((e=>!e.ship.isSunk())).length}},fire(s,a=[t(0,10),t(0,10)]){let r=Number(a[0]),i=Number(a[1]);for(;"miss"===s.board.getInfo([r,i])||"hit"==s.board.getInfo([r,i]);)r=t(0,10),i=t(0,10);return"Hit!"===s.board.recieveAttack([r,i])?{message:`Hit at ${e[r]}${i+1}!`,coordinates:[r,i]}:{message:`Miss at ${e[r]}${i+1}!`,coordinates:[r,i]}}}}const a=document.getElementById("player-y-and-grid"),r=document.getElementById("opponent-y-and-grid"),i=document.createElement("div");i.id="player-grid",i.classList.add("game-grid");const n=document.createElement("div");n.id="opponent-grid",n.classList.add("game-grid");for(let e=0;e<10;e++)for(let t=0;t<10;t++){let s=document.createElement("div");s.dataset.x=e,s.dataset.y=t,s.classList.add("player"),s.classList.add("cell"),i.appendChild(s);let a=document.createElement("div");a.dataset.x=e,a.dataset.y=t,a.classList.add("opponent"),a.classList.add("cell"),n.appendChild(a)}let d,l;a.appendChild(i),r.appendChild(n);let o={destroyer:null,cruiser:null,submarine:null,battleship:null,carrier:null};const c=document.querySelectorAll(".new-ship");window.addEventListener("keydown",(e=>{if("r"==e.key&&d.classList.contains("new-ship"))if(d.classList.contains("r")){if(Number(d.parentNode.dataset.x)+l>10)return;d.classList.remove("r")}else{if(Number(d.parentNode.dataset.y)+l>10)return;d.classList.add("r")}})),c.forEach((e=>{e.addEventListener("dragstart",(e=>{d=e.target,l=Number(d.dataset.length),d.classList.add("dragged")}))})),i.addEventListener("dragover",(e=>{e.preventDefault()})),i.addEventListener("drop",(e=>{if(e.preventDefault(),d.classList.remove("dragged"),d.parentNode!=e.target&&e.target!=d){if(d.classList.contains("r")){if(Number(e.target.dataset.y)+l>10)return}else if(Number(e.target.dataset.x)+l>10)return;d.classList.contains("not-placed")&&d.classList.remove("not-placed"),d.classList.contains("destroyer")?o.destroyer=[Number(e.target.dataset.y),Number(e.target.dataset.x)]:d.classList.contains("cruiser")?o.cruiser=[Number(e.target.dataset.y),Number(e.target.dataset.x)]:d.classList.contains("submarine")?o.submarine=[Number(e.target.dataset.y),Number(e.target.dataset.x)]:d.classList.contains("battleship")?o.battleship=[Number(e.target.dataset.y),Number(e.target.dataset.x)]:d.classList.contains("carrier")&&(o.carrier=[Number(e.target.dataset.y),Number(e.target.dataset.x)]),o.destroyer&&o.cruiser&&o.submarine&&o.battleship&&o.carrier&&(document.getElementById("player-submit-ships").disabled=!1),d.parentNode.removeChild(d),e.target.appendChild(d)}})),document.getElementById("name-input").addEventListener("click",(function(){let e=document.getElementById("player-name-input").value,t=document.getElementById("opponent-name-input").value,a=document.getElementById("computer-checkbox").checked;a&&(t="Computer"),""==e&&(e="Player"),document.getElementById("background").remove(),function(e,t,a=!0){const r=s(e,!1),i=s(t,a);document.getElementById("player-name").innerText=e+"'s Board",document.getElementById("opponent-name").innerText=t+"'s Board",n.classList.add("hidden"),r.board.placeShip(3,[0,0],[0,2]),i.board.placeShip(4,[5,6],[8,6]),r.board.ships.forEach((e=>{e.cells.forEach((e=>{document.querySelector(`.player[data-x="${e[0]}"][data-y="${e[1]}"]`).classList.add("ship")}))})),i.board.ships.forEach((e=>{e.cells.forEach((e=>{document.querySelector(`.opponent[data-x="${e[0]}"][data-y="${e[1]}"]`).classList.add("ship")}))}));const d=function(s){let a=r.fire(i,[s.target.dataset.x,s.target.dataset.y]),l=document.querySelector(`.opponent[data-x="${a.coordinates[0]}"][data-y="${a.coordinates[1]}"]`);if(console.log(a.message),a.message.includes("Miss"))l.classList.add("miss"),l.innerText="O";else if(a.message.includes("Hit")&&(l.classList.add("hit"),l.innerText="X",i.board.allShipsSunk()))return alert(`${e} Wins!`),void n.removeEventListener("click",d);if(i.isComputer){let e=i.fire(r),s=document.querySelector(`.player[data-x="${e.coordinates[0]}"][data-y="${e.coordinates[1]}"]`);if(e.message.includes("Miss"))s.classList.add("miss"),s.innerText="O";else if(e.message.includes("Hit")&&(s.classList.add("hit"),s.innerText="X",r.board.allShipsSunk()))return alert(`${t} Wins!`),void n.removeEventListener("click",d)}};n.addEventListener("click",d)}(e,t,a)}))})();